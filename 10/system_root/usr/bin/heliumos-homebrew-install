#!/usr/bin/env python3

from sys import stderr
from urllib.request import urlretrieve
import subprocess

script_install_path = '/tmp/homebrew-install.sh'
script_env_path = '/etc/profile.d/homebrew.sh'

shell = lambda command: subprocess.run(command.split())

try:
    urlretrieve(
        url='https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh',
        filename=script_install_path
    )
except:
    print("Failed to download Homebrew installation script", file=stderr)
    exit(1)

shell(f'/usr/bin/bash {script_install_path}')

shell(f'sudo touch {script_env_path}')
shell(f'sudo echo \'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"\' >> {script_env_path}')
shell(f'sudo echo \'export C_INCLUDE_PATH=$CC_INCLUDE_PATH:/var/home/linuxbrew/.linuxbrew/include/\' >> {script_env_path}')

print("*" * 80)
print("Complete!")
print(f"Run `source {script_env_path}` or login again to start using Homebrew with `brew`!")

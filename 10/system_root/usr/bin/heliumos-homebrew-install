#!/usr/bin/env python3

from sys import stderr
from urllib.request import urlretrieve
import subprocess
import os

script_install_path = '/tmp/homebrew-install.sh'
script_env_temp_path = '/tmp/homebrew-profile.sh'
script_env_path = '/etc/profile.d/homebrew.sh'

shell = lambda command: subprocess.run(command.split(), check=True)

if os.path.exists(script_install_path):
  os.remove(script_install_path)

try:
    urlretrieve(
        url='https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh',
        filename=script_install_path
    )
except Exception as e:
    print(f"Failed to download Homebrew installation script: {e}", file=stderr)
    exit(1)

shell(f'bash {script_install_path}')

with open(script_env_temp_path, 'w') as f:
    f.write('eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)" \n')
    f.write('export PATH=$PATH:/home/linuxbrew/.linuxbrew/bin/ \n')
    f.write('export C_INCLUDE_PATH=$CC_INCLUDE_PATH:/var/home/linuxbrew/.linuxbrew/include/ \n')

shell(f'sudo mv {script_env_temp_path} {script_env_path}')

print("*" * 80)
print("Complete!")
print(f"Run `source {script_env_path}` or login again to start using Homebrew with `brew`!")

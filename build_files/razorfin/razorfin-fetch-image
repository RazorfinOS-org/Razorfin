#!/usr/bin/bash
# Display Razorfin image name and branch

IMAGE_NAME="razorfin"
IMAGE_BRANCH="latest"

# Get image name and branch from image-info.json if it exists
if [[ -f /usr/share/ublue-os/image-info.json ]]; then
    IMAGE_NAME=$(jq -r '.["image-name"] // "razorfin"' < /usr/share/ublue-os/image-info.json 2>/dev/null || echo "razorfin")
    IMAGE_BRANCH=$(jq -r '.["image-branch"] // "latest"' < /usr/share/ublue-os/image-info.json 2>/dev/null || echo "latest")
fi

echo -n "${IMAGE_NAME}:${IMAGE_BRANCH}"

# Check if booted from signed image - show lock icon if signed, warning if not
if [[ "$(rpm-ostree status --json --booted 2>/dev/null)" =~ "ostree-image-signed" ]]; then
    echo -n -e " 󰌾"
else
    echo -n -e " \033[6;31m󰀦\033[0m"
fi

#!/usr/bin/env bash

set -eoux pipefail

old_favorites=$(sqlite3 ~/.local/share/kactivitymanagerd/resources/database "SELECT targettedResource FROM 'ResourceLink';")
 
for fav in $old_favorites; do
    qdbus-qt6 org.kde.ActivityManager /ActivityManager/Resources/Linking \
        org.kde.ActivityManager.ResourcesLinking.UnlinkResourceFromActivity \
        "org.kde.plasma.favorites.applications" \
        "applications:$fav" \
        ":global"
done

new_favorites="preferred://browser,org.kde.kontact.desktop,systemsettings.desktop,org.kde.dolphin.desktop,org.kde.kwrite.desktop,org.kde.konsole.desktop,org.kde.discover.desktop"
 
echo "$new_favorites" | tr ',' '\n' | while read -r fav; do
    qdbus-qt6 org.kde.ActivityManager /ActivityManager/Resources/Linking \
        org.kde.ActivityManager.ResourcesLinking.LinkResourceToActivity \
        "org.kde.plasma.favorites.applications" \
        "applications:$fav" \
        ":global"
done

